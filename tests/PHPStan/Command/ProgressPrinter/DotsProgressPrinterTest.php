<?php declare(strict_types = 1);

namespace PHPStan\Command\ProgressPrinter;

class DotsProgressPrinterTest extends TestBaseProgressPrinter
{

	public function dataProgressPrinterProvider(): iterable
	{
		yield [
			[],
			'

',
		];

		yield [
			[
				true,
				true,
				true,
				false,
				true,
				false,
			],
			'...F.F

',
		];

		yield [
			[
				false,
				false,
				true,
				true,
				true,
				true,
				false,
				false,
				true,
				true,
				true,
				true,
				true,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				true,
				true,
				false,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				true,
				true,
				true,
				true,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				true,
				false,
				false,
				true,
				true,
				false,
				false,
				true,
				true,
				true,
				true,
				true,
				true,
				true,
				true,
				false,
				false,
				false,
				true,
				false,
				true,
				true,
				false,
				false,
				false,
				true,
				true,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				false,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				true,
				false,
				true,
				true,
				false,
				false,
				true,
				true,
				false,
				false,
				false,
				false,
				false,
				false,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				false,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				false,
				false,
				false,
				false,
				true,
				false,
				false,
				false,
				true,
				false,
				false,
				false,
				true,
				true,
				true,
				false,
				true,
				false,
				true,
				false,
				true,
				false,
				false,
				false,
				false,
				false,
				true,
				false,
				false,
				true,
				false,
				true,
				false,
				false,
				false,
				true,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				false,
				false,
				false,
				true,
				false,
				true,
				true,
				true,
				false,
				false,
				true,
				false,
				false,
				true,
				false,
				false,
				false,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				false,
				true,
				true,
				true,
				true,
				true,
				false,
				true,
				true,
				true,
				true,
				false,
				false,
				false,
				true,
			],
			'FF....FF......F.FFFF..F..FF.F.F.FFFFF.FFFFF.FF.F.F.FFFFF....  60 / 270 (22%)
F.F....F.FFFFF.FF..FF........FFF.F..FFF....FF.F.F.F.F.F..... 120 / 270 (44%)
.FF.F.FFFFFFFF..FF.F.F......F..FF..FFFFFF..FF.F.....FF.F.... 180 / 270 (67%)
.FFFF.FFF.FFF...F.F.F.FFFFF.FF.F.FFF.F.F....F.F....FFF.F...F 240 / 270 (89%)
F.FF.FFF.F.....F.....F....FFF.

',
		];
	}

	/**
	 * @dataProvider dataProgressPrinterProvider
	 *
	 * @param bool[] $data
	 * @param string $expected
	 */
	public function testProgressPrinter(
		array $data,
		string $expected
	): void
	{
		$this->skipIfNotOnUnix();
		$progressPrinter = new DotsProgressPrinter();
		$progressPrinter->setOutputStyle($this->getErrorConsoleStyle());

		$progressPrinter->start(count($data));
		foreach ($data as $datum) {
			$file = __DIR__ . '/some/file.php';
			$errors = $datum ? [] : ['An error!'];
			$progressPrinter->beforeAnalyzingFile($file);
			$progressPrinter->afterAnalyzingFile($file, $errors);
		}
		$progressPrinter->finish();

		$this->assertSame($expected, $this->getOutputContent());
	}

}
